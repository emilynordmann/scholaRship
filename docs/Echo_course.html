<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 7 Exploring Echo360 video/course level data in R with tidyverse | scholaRship</title>
<meta name="author" content="Emily Nordmann, Craig Alexander, James Bartlett, Eilidh Jack, Gaby Mahrholz, Jill MacKay, Mitchum Bock">
<meta name="generator" content="bookdown 0.34 with bs4_book()">
<meta property="og:title" content="Chapter 7 Exploring Echo360 video/course level data in R with tidyverse | scholaRship">
<meta property="og:type" content="book">
<meta property="og:url" content="https://psyteachr.github.io/scholaRship/Echo_course.html">
<meta property="og:image" content="https://psyteachr.github.io/scholaRship/images/logos/logo.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 7 Exploring Echo360 video/course level data in R with tidyverse | scholaRship">
<meta name="twitter:image" content="https://psyteachr.github.io/scholaRship/images/logos/logo.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.0/transition.js"></script><script src="libs/bs3compat-0.5.0/tabs.js"></script><script src="libs/bs3compat-0.5.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><script src="libs/plotly-binding-4.10.2/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6NP3MF25W3');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="include/psyteachr.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
<meta name="description" content="7.1 Introduction Now we have introduced you to the basic principles of reading and summarising Echo360 data, in this chapter we will explore how you can wrangle and visualise video and course...">
<meta property="og:description" content="7.1 Introduction Now we have introduced you to the basic principles of reading and summarising Echo360 data, in this chapter we will explore how you can wrangle and visualise video and course...">
<meta name="twitter:description" content="7.1 Introduction Now we have introduced you to the basic principles of reading and summarising Echo360 data, in this chapter we will explore how you can wrangle and visualise video and course...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">scholaRship</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Overview</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="creating-synthetic-datasets.html"><span class="header-section-number">2</span> Creating synthetic datasets</a></li>
<li><a class="" href="moodle-assignment-submission-reports.html"><span class="header-section-number">3</span> Moodle Assignment submission reports</a></li>
<li><a class="" href="workshop.html"><span class="header-section-number">4</span> ALT Conference Prep</a></li>
<li><a class="" href="anonymous.html"><span class="header-section-number">5</span> Creating Anonymous Data From Synthetic Data</a></li>
<li><a class="" href="Echo_tidy.html"><span class="header-section-number">6</span> Getting started with Echo360 data in R with tidyverse</a></li>
<li><a class="active" href="Echo_course.html"><span class="header-section-number">7</span> Exploring Echo360 video/course level data in R with tidyverse</a></li>
<li><a class="" href="Echo_combine.html"><span class="header-section-number">8</span> Combining Echo360 data with other sources of data in R with tidyverse</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="installing-r.html"><span class="header-section-number">A</span> Installing R</a></li>
<li><a class="" href="symbols.html"><span class="header-section-number">B</span> Symbols</a></li>
<li><a class="" href="conventions.html"><span class="header-section-number">C</span> Conventions</a></li>
<li><a class="" href="license.html">License</a></li>
<li><a class="" href="references-1.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/psyteachr/scholaRship">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="Echo_course" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> Exploring Echo360 video/course level data in R with <code>tidyverse</code><a class="anchor" aria-label="anchor" href="#Echo_course"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction-1" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-1"><i class="fas fa-link"></i></a>
</h2>
<p>Now we have introduced you to the basic principles of reading and summarising Echo360 data, in this chapter we will explore how you can wrangle and visualise video and course level data to recreate and build on the kind of dashboards you can access on Echo360.</p>
<p>You will need the following packages which are the same as chapter 6, but with the addition of <code>scales</code> to add some useful functions for plotting graph axes. You will also need the <code>data</code> object you created in chapter 6, but you can rerun the code below if you do not have it available already. If you do not have the data downloaded already, please <a href="data/Echo360_Data/Echo360_data.zip">download the .zip file</a> containing 9 files of Echo360 data. Our tutorial assumes you have a folder called "data" in your working directory, and we created a subfolder called "Echo360_Data" to place these files. If you saved the data in another way, remember to edit the file paths first.</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span> <span class="co"># Package of packages for plotting and wrangling </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com">plotly</a></span><span class="op">)</span> <span class="co"># Creates interactive plots </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span> <span class="co"># Builds on ggplot2 to build specific publication ready plots </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span> <span class="co"># Includes functions for specifying plot scales</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Obtain list of files from directory</span></span>
<span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"data/Echo360_Data/"</span>, </span>
<span>                    pattern<span class="op">=</span><span class="st">".csv"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Read in all files</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"data/Echo360_Data/"</span>, <span class="va">files</span><span class="op">)</span>, <span class="co"># Add our working directory to the list of files </span></span>
<span>                 id<span class="op">=</span><span class="st">"video"</span><span class="op">)</span> <span class="co"># What should be call the column containing the name of the video file? </span></span>
<span></span>
<span><span class="co"># Fill in spaces between column names</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tibble/man/tibble.html">tibble</a></span><span class="op">(</span><span class="va">data</span>, </span>
<span>               .name_repair <span class="op">=</span> <span class="st">"universal"</span><span class="op">)</span> <span class="co"># Setting to universal makes all names unique and syntactic</span></span>
<span></span>
<span><span class="co"># To break this code down, we start with the innermost function</span></span>
<span><span class="co"># 1. We first make each unique video name a factor (unique category)</span></span>
<span><span class="co"># 2. We then make each factor a number, so we get an ascending number from 1 to 9</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">video</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">video</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="handling-datetime-data-with-lubridate" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> Handling date/time data with <code>lubridate</code><a class="anchor" aria-label="anchor" href="#handling-datetime-data-with-lubridate"><i class="fas fa-link"></i></a>
</h2>
<p>Handling date/time data in R is somewhat different from other variable types and should be treated differently and handled with care. The <code>lubridate</code> package in R (loaded as part of the <code>tidyverse</code>) allows us to easily handle tricky date/time data and extract useful information from these.</p>
<div id="converting-variables-to-datetime-format" class="section level3" number="7.2.1">
<h3>
<span class="header-section-number">7.2.1</span> Converting variables to date/time format<a class="anchor" aria-label="anchor" href="#converting-variables-to-datetime-format"><i class="fas fa-link"></i></a>
</h3>
<p>The first task will be to convert any date/time data we have into the correct format. In the sample data we are working with, we have five variables which contain such data which are: <code>Create.Date</code>, <code>Duration</code>, <code>Total.View.Time</code>, <code>Average.View.Time</code> and <code>Last.Viewed</code>.</p>
<p>On closer inspection, these variables fall into two types:</p>
<ul>
<li><p><code>Create.Data</code> and <code>Last.Viewed</code> are listed as a date (a particular day)</p></li>
<li><p><code>Duration</code>, <code>Total.View.Time</code> and <code>Average.View.Time</code> are listed as a time, recorded in hours, minutes, and seconds.</p></li>
</ul>
<p>Several functions can be used to take a data string and convert it into the desired date/time format. There is a useful <a href="https://rstudio.github.io/cheatsheets/html/lubridate.html">cheat sheet you can download</a> for the <code>lubridate</code> library which contains examples of such functions. For our data, we will use the <code><a href="https://lubridate.tidyverse.org/reference/ymd.html">mdy()</a></code> function to convert dates as month-day-year, and the <code><a href="https://lubridate.tidyverse.org/reference/hms.html">hms()</a></code> function to convert times as hours-minutes-seconds.</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For times, mutate across three columns and convert to hours, minutes, seconds</span></span>
<span><span class="co"># For dates, mutate across two columns and convert to month, day, year</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'duration'</span>, <span class="st">'total_view_time'</span>, <span class="st">'average_view_time'</span><span class="op">)</span>, </span>
<span>                .fns <span class="op">=</span> <span class="va">hms</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'create_date'</span>, <span class="st">'last_viewed'</span><span class="op">)</span>, </span>
<span>                .fns <span class="op">=</span> <span class="va">mdy</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Here, we use a combination of mutate and across to apply a given function to multiple columns. Within across, we specify two arguments. In .cols, we specify the columns we want to apply our function to and in .fns, we specify the function we want to apply to those columns.</p>
<div class="info">
<p><code><a href="https://lubridate.tidyverse.org/reference/hms.html">hms()</a></code> converts a string into a date/time object which is set by hours-minutes-seconds. <code><a href="https://lubridate.tidyverse.org/reference/ymd.html">mdy()</a></code> converts a string into a date/time object which is set by month-day-year. Echo360 data saves date/times in US format, so pay attention to how date/time data is stored to data you work with to make sure it recognises the information in the right order. There are alternative functions like <code><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd()</a></code> and <code><a href="https://lubridate.tidyverse.org/reference/ymd.html">dmy()</a></code> if data you work with is stored differently.</p>
</div>
<p>We can take a look at the result of these transformations more closely using <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code> to preview the first five cases of each variable:</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First five cases of duration </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">duration</span><span class="op">)</span></span>
<span><span class="co"># First five cases of last viewed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">last_viewed</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "13M 11S" "13M 11S" "13M 11S" "13M 11S" "13M 11S" "13M 11S"
## [1] "2023-01-16" "2023-01-18" "2023-01-24" "2023-01-15" "2023-01-16"
## [6] "2023-02-15"</code></pre>
</div>
<div id="extracting-elements-from-datetime-data" class="section level3" number="7.2.2">
<h3>
<span class="header-section-number">7.2.2</span> Extracting elements from date/time data<a class="anchor" aria-label="anchor" href="#extracting-elements-from-datetime-data"><i class="fas fa-link"></i></a>
</h3>
<p>Sometimes, you may wish to obtain specific parts of a date/time such as the month, the minutes etc. There are several functions in <code>lubridate</code> which allow us to extract these easily from a date/time object.</p>
<p>Say we wish to only obtain the minutes from <code>Average.View.Time</code>, we can obtain this easily using the <code><span><span class="fu">minute</span><span class="op">(</span><span class="op">)</span></span></code> function and preview the first five cases.</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add a new average view minutes column to our data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>average_view_minute <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/minute.html">minute</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">average_view_time</span><span class="op">)</span><span class="op">)</span> <span class="co"># Isolate the minutes from the average view time column</span></span>
<span></span>
<span><span class="co"># Print the first five cases</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">average_view_minute</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 10 12 13  5  9  2</code></pre>
<p>As we start to get into the habit of visualising data to aid exploration, we can quickly observe some summary statistics by producing a boxplot of the average view time in minutes.</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fig_avg_minutes</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">average_view_minute</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># We only need the y axis of view time minutes</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Add a boxplot layer</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Boxplot of average video viewing times"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"View time (mins)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Specify the main title and y axis label</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Tidy up the theme</span></span>
<span></span>
<span><span class="va">fig_avg_minutes</span></span></code></pre></div>
<div class="inline-figure"><img src="07-Echo_course_files/figure-html/average%20minute%20boxplot-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>Sometimes it can be difficult to precisely identify the y axis value for each element in a plot, so you can also produce an interactive version of the boxplot by using the <code class="package">plotly</code> package. Once we define a graph in <code>ggplot2</code>, we can convert it into an interactive plot using the <code><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly()</a></code> function.</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="va">fig_avg_minutes</span><span class="op">)</span></span></code></pre></div>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-5a8919f24e84a3803ee4" style="width:100%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-5a8919f24e84a3803ee4">{"x":{"data":[{"y":[10,12,13,5,9,2,6,5,12,13,8,0,10,13,13,12,13,6,13,12,11,6,6,0,13,12,12,12,13,13,13,2,13,13,13,13,13,7,13,6,6,13,6,6,6,13,13,0,4,13,4,13,13,6,6,2,13,11,10,11,13,3,6,8,13,6,13,1,4,11,13,13,13,13,1,12,13,5,11,13,7,13,6,13,12,6,13,13,13,13,3,9,10,13,6,3,13,6,3,12,13,6,13,6,0,13,13,12,13,12,12,6,12,13,13,2,13,13,6,13,13,12,10,13,6,13,4,13,3,6,6,10,6,6,0,6,13,13,13,7,13,13,6,6,6,12,4,12,7,12,13,6,13,11,5,13,6,9,13,8,13,13,13,6,6,13,4,4,4,12,13,11,13,13,13,13,10,12,10,13,5,11,4,2,13,4,5,13,13,13,6,13,11,13,13,12,13,13,6,13,12,6,13,13,11,12,13,13,12,12,6,13,11,12,6,13,0,7,7,12,13,6,13,13,13,12,13,13,13,6,13,6,13,4,13,13,12,11,13,13,13,13,10,13,13,0,6,13,12,11,13,3,6,0,12,3,13,0,11,7,13,12,13,7,1,7,13,12,13,13,13,13,6,13,13,6,13,13,13,7,13,11,6,12,13,6,5,13,7,9,13,13,13,12,0,4,13,13,13,13,13,13,3,13,13,12,5,12,7,13,0,13,4,13,12,6,12,12,13,13,3,13,12,10,6,6,11,13,13,13,9,12,13,13,6,13,13,4,13,13,13,13,12,13,12,13,13,9,13,6,13,13,13,13,4,13,6,6,13,13,7,13,12,2,6,13,9,13,12,12,6,4,6,7,6,6,3,13,13,13,10,13,13,13,14,14,14,13,12,14,3,15,6,12,5,15,14,4,13,14,15,9,4,7,11,0,15,15,14,14,15,14,15,7,14,15,15,14,15,14,15,3,15,7,12,5,14,10,15,13,15,14,14,15,12,0,15,15,15,6,14,0,14,6,14,0,6,6,14,14,7,15,2,15,15,12,6,15,14,15,15,12,12,7,15,15,14,14,8,8,15,0,6,15,14,1,10,15,15,8,7,15,15,14,15,15,12,5,15,14,6,7,14,15,14,14,14,14,14,6,1,9,13,9,15,6,15,10,15,14,6,13,14,15,15,6,13,15,14,5,5,7,14,15,15,15,15,14,12,15,8,7,15,15,15,14,14,14,7,15,5,9,2,14,14,14,13,15,14,9,7,10,14,3,8,15,7,4,13,13,14,15,9,15,11,15,15,15,16,14,16,16,16,16,0,16,16,16,16,16,8,16,13,14,8,3,8,16,8,0,16,8,16,6,16,16,16,16,5,15,16,16,16,16,16,16,5,16,16,15,4,8,16,1,16,16,16,7,16,8,8,7,0,3,8,16,16,0,16,16,16,15,16,11,16,16,15,6,8,7,16,16,8,16,8,2,8,16,0,12,16,16,12,16,16,13,8,16,14,8,16,16,16,16,16,8,8,16,16,10,14,16,16,5,13,8,10,10,16,8,16,16,7,16,16,16,1,12,16,15,5,16,15,16,0,8,16,16,14,16,16,13,16,14,16,10,16,16,15,16,16,8,15,8,11,16,16,0,5,16,5,12,12,8,16,13,2,16,7,5,7,0,16,0,13,10,3,10,5,5,5,10,0,10,10,10,10,10,10,10,8,2,10,10,10,10,10,10,10,5,10,10,10,10,5,10,10,10,10,7,10,10,10,10,10,9,10,10,10,10,10,10,10,10,10,4,5,10,10,1,10,10,10,10,10,9,10,10,10,6,5,10,5,10,10,10,5,3,1,0,5,10,10,10,10,5,10,5,0,10,10,10,10,10,5,10,10,5,10,10,9,5,10,5,9,10,7,10,10,10,8,10,10,10,10,10,10,10,10,5,10,10,10,10,10,10,10,5,10,4,10,10,10,5,5,10,10,10,6,5,10,6,10,10,4,10,10,10,10,10,10,0,6,5,10,10,10,16,14,13,7,8,13,10,16,3,11,14,16,16,3,10,15,14,9,8,7,8,16,16,16,14,15,16,8,7,16,16,16,11,12,16,16,16,10,9,16,16,16,16,16,16,13,9,12,6,11,15,5,0,15,9,16,11,16,3,16,16,14,5,7,16,16,6,16,16,16,5,0,15,16,16,11,6,12,16,12,13,13,10,8,10,13,16,16,16,16,10,9,14,16,5,4,16,7,0,16,14,11,16,16,16,16,16,12,11,4,5,9,16,16,16,0,16,14,16,8,5,16,11,14,16,16,14,16,16,16,13,16,16,14,16,16,4,13,13,8,16,2,13,14,15,11,14,14,5,7,4,14,2,14,14,6,13,14,14,14,7,0,12,14,14,13,14,14,14,14,14,14,14,14,14,12,14,14,14,14,13,14,14,13,14,6,7,14,0,14,14,14,14,7,14,14,14,14,14,14,4,7,10,14,14,1,7,2,14,14,14,9,14,14,13,14,14,4,14,7,14,13,9,12,14,7,8,14,6,14,14,14,14,13,13,14,7,14,14,14,13,12,11,13,14,14,7,14,7,4,14,14,5,14,14,14,14,14,14,14,13,14,13,14,14,14,14,14,14,12,0,14,13,14,14,13,13,0,14,7,14,14,0,7,14,14,13,14,14,14,12,14,14,7,7,7,14,14,14,7,14,14,14,4,14,3,14,14,14,3,14,5,14,14,13,12,14,14,14,14,14,14,14,7,14,9,14,14,14,14,14,14,14,14,14,14,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,7,14,14,7,2,14,14,14,14,14,14,14,14,7,14,14,14,14,6,14,7,3,9,12,14,7,14,14,7,14,7,14,14,14,14,13,7,14,14,14,7,14,14,2,14,14,7,0,14,14,7,14,14,5,3,14,14,14,14,14,14,14,14,2,14,14,14,14,14,13,14,6,14,14,4,7,14,14,14,11,14,14,2,14,5,1,7,14,12,14,14,14,5,8,11,14,7,15,18,18,8,18,8,18,18,2,15,18,14,18,18,14,13,9,16,18,18,7,18,18,18,14,18,0,5,0,15,14,18,14,9,17,18,15,18,18,17,14,16,13,18,7,9,16,18,18,14,9,18,9,13,11,11,13,6,18,15,16,18,4,6,15,7,9,15,7,18,18,13,18,8,18,18,18,3,5,12,17,4,18,7,18,8,0,18,18,14,15,18,18,14,12,6,17,15,18,18,18,1,16,18,18,18,13,18,9,10,12,18,18,17,9,18,18,15,18,9,14,9,0,9,8,5,8,13,16],"hoverinfo":"y","type":"box","fillcolor":"rgba(255,255,255,1)","marker":{"opacity":null,"outliercolor":"rgba(0,0,0,1)","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)"},"size":5.6692913385826778},"line":{"color":"rgba(51,51,51,1)","width":1.8897637795275593},"showlegend":false,"xaxis":"x","yaxis":"y","frame":null}],"layout":{"margin":{"t":43.762557077625573,"r":7.3059360730593621,"b":25.570776255707766,"l":37.260273972602747},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"Boxplot of average video viewing times","font":{"color":"rgba(0,0,0,1)","family":"","size":17.534246575342465},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.41249999999999998,0.41249999999999998],"tickmode":"array","ticktext":["-0.4","-0.2","0.0","0.2","0.4"],"tickvals":[-0.40000000000000002,-0.19999999999999998,0,0.20000000000000007,0.40000000000000002],"categoryorder":"array","categoryarray":["-0.4","-0.2","0.0","0.2","0.4"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.90000000000000002,18.899999999999999],"tickmode":"array","ticktext":["0","5","10","15"],"tickvals":[0,5.0000000000000009,10,15],"categoryorder":"array","categoryarray":["0","5","10","15"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"View time (mins)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"577845005bcd":{"y":{},"type":"box"}},"cur_data":"577845005bcd","visdat":{"577845005bcd":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><p>As a further example using a date variable, suppose we want to look at the last month students viewed videos across the course. We can obtain this by applying the <code><span><span class="fu">month</span><span class="op">(</span><span class="op">)</span></span></code> function to the <code>Last.Viewed</code> variable.</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add a new month column </span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>month_last_viewed <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">last_viewed</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">last_viewed</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">month_last_viewed</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Only specify x axis for a bar chart</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Create a bar chart </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Frequency of last month video viewed"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Frequency"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Last month video viewed"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/breaks_pretty.html">breaks_pretty</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Function to tidy up the x axis breaks specifically for dates</span></span>
<span></span>
<span><span class="va">last_viewed</span></span></code></pre></div>
<div class="inline-figure"><img src="07-Echo_course_files/figure-html/last%20month%20viewed%20bar%20chart-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>As above, we can convert the bar chart to make it interactive using the <code><span><span class="fu">ggplotly</span><span class="op">(</span><span class="op">)</span></span></code> function. This allows you to hover over the plot and see what the frequency was for each month.</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="va">last_viewed</span><span class="op">)</span></span></code></pre></div>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-74abe68ec227ba830782" style="width:100%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-74abe68ec227ba830782">{"x":{"data":[{"orientation":"v","width":[0.89999999999999991,0.90000000000000013,0.89999999999999858],"base":[0,0,0],"x":[1,2,12],"y":[1339,126,1],"text":["count: 1339<br />month_last_viewed:  1","count:  126<br />month_last_viewed:  2","count:    1<br />month_last_viewed: 12"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(89,89,89,1)","line":{"width":1.8897637795275593,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.762557077625573,"r":7.3059360730593621,"b":40.182648401826491,"l":48.949771689497723},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"Frequency of last month video viewed","font":{"color":"rgba(0,0,0,1)","family":"","size":17.534246575342465},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.044999999999999929,13.045],"tickmode":"array","ticktext":["0","2","4","6","8","10","12"],"tickvals":[0,2,4,6,8,10,12],"categoryorder":"array","categoryarray":["0","2","4","6","8","10","12"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Last month video viewed","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-66.950000000000003,1405.95],"tickmode":"array","ticktext":["0","500","1000"],"tickvals":[0,500.00000000000006,1000],"categoryorder":"array","categoryarray":["0","500","1000"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Frequency","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"577823e9c":{"x":{},"type":"bar"}},"cur_data":"577823e9c","visdat":{"577823e9c":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="maths-with-date-times" class="section level3" number="7.2.3">
<h3>
<span class="header-section-number">7.2.3</span> Maths with date-times<a class="anchor" aria-label="anchor" href="#maths-with-date-times"><i class="fas fa-link"></i></a>
</h3>
<p>Sometimes, we may wish to compare the difference in time between events. <code class="package">lubridate</code> provides some useful functions to help us with this. For example, we can look at the difference in average view time to the total duration of the video by using simple arithmetic operators.</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_video1</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">video</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># Filter the videos to select only video 1</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time_difference <span class="op">=</span> <span class="va">average_view_time</span> <span class="op">-</span> <span class="va">duration</span><span class="op">)</span> <span class="co"># Add a time difference column between average view time and total duration</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">data_video1</span><span class="op">$</span><span class="va">time_difference</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "-3M 44S"  "-1M 35S"  "-2S"      "-8M 5S"   "-4M 48S"  "-11M -9S"</code></pre>
<p>As this data returns values in minutes and seconds, we can transform this to one unit type for consistency, then use that data to create a boxplot.</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_video1</span> <span class="op">&lt;-</span> <span class="va">data_video1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time_difference <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/second.html">second</a></span><span class="op">(</span><span class="va">time_difference</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">time_difference</span> <span class="op">&lt;-</span> <span class="va">data_video1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">time_difference</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Boxplot of average video viewing times compared to total video duration"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"View time (Seconds)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="co"># Add a horizontal line at 0 to show no difference</span></span>
<span></span>
<span><span class="va">time_difference</span></span></code></pre></div>
<div class="inline-figure"><img src="07-Echo_course_files/figure-html/time%20difference%20boxplot-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>There's a little skew here so we cannot see the full box, but the red horizontal line shows no difference in average view time to the duration of video 1, so where students viewed the whole video. More positive values represent students who watched less of the video than the total duration.</p>
<p>As before, we can make these values interactive by converting our ggplot visualisation to a <code class="package">plotly</code> object.</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="va">time_difference</span><span class="op">)</span></span></code></pre></div>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-ba7027d55ee7d1a533f8" style="width:100%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-ba7027d55ee7d1a533f8">{"x":{"data":[{"y":[44,35,-2,5,48,-9,9,37,44,0,48,4,47,0,0,32,0,0,-1,46,14,22,19,-5,0,40,32,27,0,-1,0,48,-2,0,0,-1,-4,2,-6,21,-4,-6,35,43,7,0,0,-9,10,0,-3,0,-2,31,-11,34,-3,-10,48,-2,0,47,19,3,0,15,0,47,40,30,-2,0,-5,0,1,44,-5,48,14,0,18,0,2,-3,20,12,-3,0,0,0,3,13,18,-7,6,7,0,15,3,44,0,25,0,24,37,0,-1,23,0,44,20,-5,17,0,-1,33,0,0,31,-7,0,-1,-6,-2,13,0,-9,0,27,-2,15,5,27,27,6,33,0,0,0,35,0,0,25,24,25,24,9,20,-11,48,0,23,-7,20,20,-4,29,46,0,19,0,0,0,26,25,0,13,43,11,21,0,39,0,-2,0,0,4,24,-4,0,46,-11,13,29,0,10,6,-3,0,-1,13,0,43,0,0],"hoverinfo":"y","type":"box","fillcolor":"rgba(255,255,255,1)","marker":{"opacity":null,"outliercolor":"rgba(0,0,0,1)","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)"},"size":5.6692913385826778},"line":{"color":"rgba(51,51,51,1)","width":1.8897637795275593},"showlegend":false,"xaxis":"x","yaxis":"y","frame":null},{"x":[-0.41249999999999998,0.41249999999999998],"y":[0,0],"text":"yintercept: 0","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(255,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.762557077625573,"r":7.3059360730593621,"b":25.570776255707766,"l":43.105022831050235},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"Boxplot of average video viewing times compared to total video duration","font":{"color":"rgba(0,0,0,1)","family":"","size":17.534246575342465},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.41249999999999998,0.41249999999999998],"tickmode":"array","ticktext":["-0.4","-0.2","0.0","0.2","0.4"],"tickvals":[-0.40000000000000002,-0.19999999999999998,0,0.20000000000000007,0.40000000000000002],"categoryorder":"array","categoryarray":["-0.4","-0.2","0.0","0.2","0.4"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-13.949999999999999,50.950000000000003],"tickmode":"array","ticktext":["-10","0","10","20","30","40","50"],"tickvals":[-10,0,10,20.000000000000004,30.000000000000004,40,50],"categoryorder":"array","categoryarray":["-10","0","10","20","30","40","50"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"View time (Seconds)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"577871b34895":{"y":{},"type":"box"},"577845de4beb":{"yintercept":{}}},"cur_data":"577871b34895","visdat":{"577871b34895":["function (y) ","x"],"577845de4beb":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="total-views-for-each-video" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Total views for each video<a class="anchor" aria-label="anchor" href="#total-views-for-each-video"><i class="fas fa-link"></i></a>
</h2>
<p>In the following section, we will mostly be creating plots of our data summarised at the video level. Given that our data is currently stored at student level (one row per student per video), we will first transform our data into a new data set called <code>video_data</code> which will group the data by video and create some variables of interest. First, let's create this new data set with two columns:</p>
<ul>
<li><p><code>video</code>: The video number stored as a factor (this will make it easier to plot later on);</p></li>
<li><p><code>total_views</code>: The total number of views per video.</p></li>
</ul>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">video_data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">video</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>total_views <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">total_views</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># for each video, add up all the views across students</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>video <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">video</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># Turn video into a factor</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Retaining the group by can sometimes cause problems</span></span></code></pre></div>
<p>We can now easily create a bar chart of the total number of views per video.</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fig.total.views</span> <span class="op">&lt;-</span> <span class="va">video_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">video</span>, y <span class="op">=</span> <span class="va">total_views</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Since we specify a y value, just show as the value</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Total number of views per video"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Total Views"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Video"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fig.total.views</span></span></code></pre></div>
<div class="inline-figure"><img src="07-Echo_course_files/figure-html/views%20bar%20chart-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>Here, we plot the video number along the x-axis and the total number of views for each video on the y-axis. These numbers include duplications from students who have watched the videos multiple times.</p>
<p>We may also be interested in the total number of unique views, i.e. the total number of students who watched the video at least once. To do this, we need to create a new variable called <code>unique_views</code> which will contain the sum of the rows for each video. We can add this to the video-level data set <code>video_data</code>.</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">video_data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">video</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>total_Views <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">total_views</span><span class="op">)</span>, </span>
<span>            unique_views <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># For each video, count the number of rows</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>video <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">video</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We can edit the code for the previous bar chart to create a bar chart of the total number of unique student views per video as follows.</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fig.unique.views</span> <span class="op">&lt;-</span> <span class="va">video_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">video</span>, y <span class="op">=</span> <span class="va">unique_views</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Since we specify a y value, just show as the value</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Total number of unique student views per video"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Unique Student Views"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Video"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fig.unique.views</span></span></code></pre></div>
<div class="inline-figure"><img src="07-Echo_course_files/figure-html/unique%20views%20bar-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>If you want to view the values per video more precisely like a data dashboard, then you can convert your unique views bar plot into a <code class="package">plotly</code> object.</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="va">fig.unique.views</span><span class="op">)</span></span></code></pre></div>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-0019f4ccb46f22695462" style="width:100%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-0019f4ccb46f22695462">{"x":{"data":[{"orientation":"v","width":[0.89999999999999991,0.90000000000000013,0.90000000000000036,0.90000000000000036,0.90000000000000036,0.90000000000000036,0.90000000000000036,0.89999999999999947,0.89999999999999858],"base":[0,0,0,0,0,0,0,0,0],"x":[1,2,3,4,5,6,7,8,9],"y":[195,189,182,169,151,147,155,144,134],"text":["video: 1<br />unique_views: 195","video: 2<br />unique_views: 189","video: 3<br />unique_views: 182","video: 4<br />unique_views: 169","video: 5<br />unique_views: 151","video: 6<br />unique_views: 147","video: 7<br />unique_views: 155","video: 8<br />unique_views: 144","video: 9<br />unique_views: 134"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(89,89,89,1)","line":{"width":1.8897637795275593,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.762557077625573,"r":7.3059360730593621,"b":40.182648401826491,"l":43.105022831050235},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"Total number of unique student views per video","font":{"color":"rgba(0,0,0,1)","family":"","size":17.534246575342465},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.40000000000000002,9.5999999999999996],"tickmode":"array","ticktext":["1","2","3","4","5","6","7","8","9"],"tickvals":[1,2,3,4,5,6,6.9999999999999991,8,9],"categoryorder":"array","categoryarray":["1","2","3","4","5","6","7","8","9"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Video","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-9.75,204.75],"tickmode":"array","ticktext":["0","50","100","150","200"],"tickvals":[0,50,100.00000000000001,150,200],"categoryorder":"array","categoryarray":["0","50","100","150","200"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Unique Student Views","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"57782950cc5":{"x":{},"y":{},"type":"bar"}},"cur_data":"57782950cc5","visdat":{"57782950cc5":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><div id="advanced-plotly-customisation" class="section level3" number="7.3.1">
<h3>
<span class="header-section-number">7.3.1</span> Advanced <code>plotly</code> customisation<a class="anchor" aria-label="anchor" href="#advanced-plotly-customisation"><i class="fas fa-link"></i></a>
</h3>
<p>So far, we have simply transformed our ggplots into a <code class="package">plotly</code> object. However, we can add additional information in the hover text such as total views, duration of video, and average view time that might be useful to you or your viewer.</p>
<p>This is going to be a longer process, so we will break it down into a few steps. First, we need to wrangle the data so we have our key summary statistics per video. The first few lines follow the same process as above, but then we add additional summary variables like the average view time and modify existing variables in <code><span><span class="fu">mutate</span><span class="op">(</span><span class="op">)</span></span></code>.</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Isolate video number and duration of the video to append later</span></span>
<span><span class="va">video_duration</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">video</span>, <span class="va">duration</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>duration <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period_to_seconds.html">period_to_seconds</a></span><span class="op">(</span><span class="va">duration</span><span class="op">)</span><span class="op">)</span> <span class="co"># Convert duration from a period to seconds</span></span>
<span></span>
<span><span class="va">video_data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">video</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>total_views <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">total_views</span><span class="op">)</span>, </span>
<span>            unique_views <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>            average_view_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/period_to_seconds.html">period_to_seconds</a></span><span class="op">(</span><span class="va">average_view_time</span><span class="op">)</span>, <span class="co"># lubridate function to transform a period to seconds</span></span>
<span>                   na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, <span class="co"># Ignore NA values when taking mean</span></span>
<span>              <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># 0 decimals to round</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">video_duration</span>, <span class="co"># Add video duration data to our summary data</span></span>
<span>            by <span class="op">=</span> <span class="st">"video"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># Join by video number</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>video <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">video</span><span class="op">)</span>,</span>
<span>         repeated_views <span class="op">=</span> <span class="va">total_views</span> <span class="op">-</span> <span class="va">unique_views</span>, <span class="co"># Calculate repeated views subtracting unique views from total views</span></span>
<span>         percentage_viewed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">average_view_time</span> <span class="op">/</span> <span class="va">duration</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># Calculate average percentage from average view time as percentage of duration</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">video_data</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table style="width:100%;" class="table table-sm">
<colgroup>
<col width="6%">
<col width="13%">
<col width="14%">
<col width="19%">
<col width="9%">
<col width="16%">
<col width="19%">
</colgroup>
<thead><tr class="header">
<th align="left">video</th>
<th align="right">total_views</th>
<th align="right">unique_views</th>
<th align="right">average_view_time</th>
<th align="right">duration</th>
<th align="right">repeated_views</th>
<th align="right">percentage_viewed</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">291</td>
<td align="right">195</td>
<td align="right">590</td>
<td align="right">791</td>
<td align="right">96</td>
<td align="right">74.59</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">257</td>
<td align="right">189</td>
<td align="right">653</td>
<td align="right">835</td>
<td align="right">68</td>
<td align="right">78.20</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">224</td>
<td align="right">182</td>
<td align="right">707</td>
<td align="right">908</td>
<td align="right">42</td>
<td align="right">77.86</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">226</td>
<td align="right">169</td>
<td align="right">752</td>
<td align="right">994</td>
<td align="right">57</td>
<td align="right">75.65</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="right">189</td>
<td align="right">151</td>
<td align="right">546</td>
<td align="right">648</td>
<td align="right">38</td>
<td align="right">84.26</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="right">163</td>
<td align="right">147</td>
<td align="right">756</td>
<td align="right">980</td>
<td align="right">16</td>
<td align="right">77.14</td>
</tr>
</tbody>
</table></div>
</div>
<p>For each video, we now have a bunch of summary statistics like their view time, duration, and percentage of the video viewed. We can now use this information to present as a dashboard for an overview of each video.</p>
<p>This time, we are going to use <code class="package">plotly</code> directly as its easier to edit the hover text options than if we simply convert a <code>ggplot</code> object to <code>plotly</code>. In the code below, we first create a bar plot for the number of unique views for each video. We then edit the hover template to add additional information into the interactive dashboard like the duration and average view time.</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fig.all.views</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html">plot_ly</a></span><span class="op">(</span><span class="va">video_data</span>,</span>
<span>  x <span class="op">=</span> <span class="op">~</span><span class="va">video</span>,</span>
<span>  y <span class="op">=</span> <span class="op">~</span><span class="va">unique_views</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"Unique Views"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"bar"</span>,</span>
<span>  hovertemplate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Video %{x}"</span>, <span class="co"># Paste adds all the elements together, &lt;br&gt; is html code for a line break</span></span>
<span>                         <span class="st">"&lt;br&gt;Total views:"</span>, <span class="va">video_data</span><span class="op">$</span><span class="va">total_views</span>,</span>
<span>                         <span class="st">"&lt;br&gt;Unique views: %{y}"</span>,</span>
<span>                         <span class="st">"&lt;br&gt; Duration: "</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period_to_seconds.html">seconds_to_period</a></span><span class="op">(</span><span class="va">video_data</span><span class="op">$</span><span class="va">duration</span><span class="op">)</span>, <span class="co"># Convert from seconds to minutes and seconds for easier viewing</span></span>
<span>                         <span class="st">"&lt;br&gt; Average view time: "</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period_to_seconds.html">seconds_to_period</a></span><span class="op">(</span><span class="va">video_data</span><span class="op">$</span><span class="va">average_view_time</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">layout</span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Unique Views per Video'</span>, </span>
<span>         xaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Video Number'</span><span class="op">)</span>,</span>
<span>         yaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Unique Views'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fig.all.views</span></span></code></pre></div>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-cef224f5ff43f40eb26e" style="width:100%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-cef224f5ff43f40eb26e">{"x":{"visdat":{"57784ba05cc6":["function () ","plotlyVisDat"]},"cur_data":"57784ba05cc6","attrs":{"57784ba05cc6":{"x":{},"y":{},"hovertemplate":["Video %{x}<br>Total views:291<br>Unique views: %{y}<br> Duration: 13M 11S<br> Average view time: 9M 50S","Video %{x}<br>Total views:257<br>Unique views: %{y}<br> Duration: 13M 55S<br> Average view time: 10M 53S","Video %{x}<br>Total views:224<br>Unique views: %{y}<br> Duration: 15M 8S<br> Average view time: 11M 47S","Video %{x}<br>Total views:226<br>Unique views: %{y}<br> Duration: 16M 34S<br> Average view time: 12M 32S","Video %{x}<br>Total views:189<br>Unique views: %{y}<br> Duration: 10M 48S<br> Average view time: 9M 6S","Video %{x}<br>Total views:163<br>Unique views: %{y}<br> Duration: 16M 20S<br> Average view time: 12M 36S","Video %{x}<br>Total views:198<br>Unique views: %{y}<br> Duration: 14M 11S<br> Average view time: 11M 58S","Video %{x}<br>Total views:178<br>Unique views: %{y}<br> Duration: 14M 42S<br> Average view time: 12M 30S","Video %{x}<br>Total views:162<br>Unique views: %{y}<br> Duration: 18M 28S<br> Average view time: 13M 40S"],"name":"Unique Views","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Unique Views per Video","xaxis":{"domain":[0,1],"automargin":true,"title":"Video Number","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5","6","7","8","9"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"Unique Views"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":["1","2","3","4","5","6","7","8","9"],"y":[195,189,182,169,151,147,155,144,134],"hovertemplate":["Video %{x}<br>Total views:291<br>Unique views: %{y}<br> Duration: 13M 11S<br> Average view time: 9M 50S","Video %{x}<br>Total views:257<br>Unique views: %{y}<br> Duration: 13M 55S<br> Average view time: 10M 53S","Video %{x}<br>Total views:224<br>Unique views: %{y}<br> Duration: 15M 8S<br> Average view time: 11M 47S","Video %{x}<br>Total views:226<br>Unique views: %{y}<br> Duration: 16M 34S<br> Average view time: 12M 32S","Video %{x}<br>Total views:189<br>Unique views: %{y}<br> Duration: 10M 48S<br> Average view time: 9M 6S","Video %{x}<br>Total views:163<br>Unique views: %{y}<br> Duration: 16M 20S<br> Average view time: 12M 36S","Video %{x}<br>Total views:198<br>Unique views: %{y}<br> Duration: 14M 11S<br> Average view time: 11M 58S","Video %{x}<br>Total views:178<br>Unique views: %{y}<br> Duration: 14M 42S<br> Average view time: 12M 30S","Video %{x}<br>Total views:162<br>Unique views: %{y}<br> Duration: 18M 28S<br> Average view time: 13M 40S"],"name":"Unique Views","type":"bar","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><p>Like <code class="package">ggplot2</code>, once we have defined a <code class="package">plotly</code> object, we can add additional layers. In this example, we might also want to create a stacked bar plot with the total number of views split into unique student views and repeated views.</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Take the plotly object and add a trace (variable to split by) for the repeated views</span></span>
<span><span class="va">fig.all.views</span> <span class="op">&lt;-</span> <span class="va">fig.all.views</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/add_trace.html">add_trace</a></span><span class="op">(</span>y <span class="op">=</span> <span class="op">~</span><span class="va">repeated_views</span>, </span>
<span>            name <span class="op">=</span> <span class="st">'Repeated views'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">layout</span><span class="op">(</span>yaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Count'</span><span class="op">)</span>, <span class="co"># Amend the type of bar plot to make it stacked</span></span>
<span>         barmode <span class="op">=</span> <span class="st">'stack'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fig.all.views</span></span></code></pre></div>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1f7cd63de59523aeb71e" style="width:100%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-1f7cd63de59523aeb71e">{"x":{"visdat":{"57784ba05cc6":["function () ","plotlyVisDat"]},"cur_data":"57784ba05cc6","attrs":{"57784ba05cc6":{"x":{},"y":{},"hovertemplate":["Video %{x}<br>Total views:291<br>Unique views: %{y}<br> Duration: 13M 11S<br> Average view time: 9M 50S","Video %{x}<br>Total views:257<br>Unique views: %{y}<br> Duration: 13M 55S<br> Average view time: 10M 53S","Video %{x}<br>Total views:224<br>Unique views: %{y}<br> Duration: 15M 8S<br> Average view time: 11M 47S","Video %{x}<br>Total views:226<br>Unique views: %{y}<br> Duration: 16M 34S<br> Average view time: 12M 32S","Video %{x}<br>Total views:189<br>Unique views: %{y}<br> Duration: 10M 48S<br> Average view time: 9M 6S","Video %{x}<br>Total views:163<br>Unique views: %{y}<br> Duration: 16M 20S<br> Average view time: 12M 36S","Video %{x}<br>Total views:198<br>Unique views: %{y}<br> Duration: 14M 11S<br> Average view time: 11M 58S","Video %{x}<br>Total views:178<br>Unique views: %{y}<br> Duration: 14M 42S<br> Average view time: 12M 30S","Video %{x}<br>Total views:162<br>Unique views: %{y}<br> Duration: 18M 28S<br> Average view time: 13M 40S"],"name":"Unique Views","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"},"57784ba05cc6.1":{"x":{},"y":{},"hovertemplate":["Video %{x}<br>Total views:291<br>Unique views: %{y}<br> Duration: 13M 11S<br> Average view time: 9M 50S","Video %{x}<br>Total views:257<br>Unique views: %{y}<br> Duration: 13M 55S<br> Average view time: 10M 53S","Video %{x}<br>Total views:224<br>Unique views: %{y}<br> Duration: 15M 8S<br> Average view time: 11M 47S","Video %{x}<br>Total views:226<br>Unique views: %{y}<br> Duration: 16M 34S<br> Average view time: 12M 32S","Video %{x}<br>Total views:189<br>Unique views: %{y}<br> Duration: 10M 48S<br> Average view time: 9M 6S","Video %{x}<br>Total views:163<br>Unique views: %{y}<br> Duration: 16M 20S<br> Average view time: 12M 36S","Video %{x}<br>Total views:198<br>Unique views: %{y}<br> Duration: 14M 11S<br> Average view time: 11M 58S","Video %{x}<br>Total views:178<br>Unique views: %{y}<br> Duration: 14M 42S<br> Average view time: 12M 30S","Video %{x}<br>Total views:162<br>Unique views: %{y}<br> Duration: 18M 28S<br> Average view time: 13M 40S"],"name":"Repeated views","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Unique Views per Video","xaxis":{"domain":[0,1],"automargin":true,"title":"Video Number","type":"category","categoryorder":"array","categoryarray":["1","2","3","4","5","6","7","8","9"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"Count"},"barmode":"stack","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":["1","2","3","4","5","6","7","8","9"],"y":[195,189,182,169,151,147,155,144,134],"hovertemplate":["Video %{x}<br>Total views:291<br>Unique views: %{y}<br> Duration: 13M 11S<br> Average view time: 9M 50S","Video %{x}<br>Total views:257<br>Unique views: %{y}<br> Duration: 13M 55S<br> Average view time: 10M 53S","Video %{x}<br>Total views:224<br>Unique views: %{y}<br> Duration: 15M 8S<br> Average view time: 11M 47S","Video %{x}<br>Total views:226<br>Unique views: %{y}<br> Duration: 16M 34S<br> Average view time: 12M 32S","Video %{x}<br>Total views:189<br>Unique views: %{y}<br> Duration: 10M 48S<br> Average view time: 9M 6S","Video %{x}<br>Total views:163<br>Unique views: %{y}<br> Duration: 16M 20S<br> Average view time: 12M 36S","Video %{x}<br>Total views:198<br>Unique views: %{y}<br> Duration: 14M 11S<br> Average view time: 11M 58S","Video %{x}<br>Total views:178<br>Unique views: %{y}<br> Duration: 14M 42S<br> Average view time: 12M 30S","Video %{x}<br>Total views:162<br>Unique views: %{y}<br> Duration: 18M 28S<br> Average view time: 13M 40S"],"name":"Unique Views","type":"bar","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["1","2","3","4","5","6","7","8","9"],"y":[96,68,42,57,38,16,43,34,28],"hovertemplate":["Video %{x}<br>Total views:291<br>Unique views: %{y}<br> Duration: 13M 11S<br> Average view time: 9M 50S","Video %{x}<br>Total views:257<br>Unique views: %{y}<br> Duration: 13M 55S<br> Average view time: 10M 53S","Video %{x}<br>Total views:224<br>Unique views: %{y}<br> Duration: 15M 8S<br> Average view time: 11M 47S","Video %{x}<br>Total views:226<br>Unique views: %{y}<br> Duration: 16M 34S<br> Average view time: 12M 32S","Video %{x}<br>Total views:189<br>Unique views: %{y}<br> Duration: 10M 48S<br> Average view time: 9M 6S","Video %{x}<br>Total views:163<br>Unique views: %{y}<br> Duration: 16M 20S<br> Average view time: 12M 36S","Video %{x}<br>Total views:198<br>Unique views: %{y}<br> Duration: 14M 11S<br> Average view time: 11M 58S","Video %{x}<br>Total views:178<br>Unique views: %{y}<br> Duration: 14M 42S<br> Average view time: 12M 30S","Video %{x}<br>Total views:162<br>Unique views: %{y}<br> Duration: 18M 28S<br> Average view time: 13M 40S"],"name":"Repeated views","type":"bar","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="video-duration-vs.-average-percentage-viewed" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> Video duration vs. average percentage viewed<a class="anchor" aria-label="anchor" href="#video-duration-vs.-average-percentage-viewed"><i class="fas fa-link"></i></a>
</h2>
<p>As one final type of data visualisation, we will create a scatterplot of video duration against the average percentage of video viewed using <code><span><span class="st">"ggplot()"</span></span></code>.</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fig.duration.viewed</span> <span class="op">&lt;-</span> <span class="va">video_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">duration</span>, y <span class="op">=</span> <span class="va">percentage_viewed</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Video duration vs. average percentage viewed"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Average percentage of video viewed"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Video duration (Seconds)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/pretty_breaks.html">pretty_breaks</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Convert the y axis to tidier labels for percentages</span></span>
<span></span>
<span><span class="va">fig.duration.viewed</span></span></code></pre></div>
<div class="inline-figure"><img src="07-Echo_course_files/figure-html/duration%20percentage%20scatterplot-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>As before, we can convert our scatterplot into a <code class="package">plotly</code> object to make it interactive as we scroll across the values.</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly</a></span><span class="op">(</span><span class="va">fig.duration.viewed</span><span class="op">)</span></span></code></pre></div>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-ef2e76748277ece06f76" style="width:100%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-ef2e76748277ece06f76">{"x":{"data":[{"x":[791,835,908,994,648,980,851,882,1108],"y":[74.590000000000003,78.200000000000003,77.859999999999999,75.650000000000006,84.260000000000005,77.140000000000001,84.370000000000005,85.030000000000001,74.010000000000005],"text":["duration:  791<br />percentage_viewed: 74.59","duration:  835<br />percentage_viewed: 78.20","duration:  908<br />percentage_viewed: 77.86","duration:  994<br />percentage_viewed: 75.65","duration:  648<br />percentage_viewed: 84.26","duration:  980<br />percentage_viewed: 77.14","duration:  851<br />percentage_viewed: 84.37","duration:  882<br />percentage_viewed: 85.03","duration: 1108<br />percentage_viewed: 74.01"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,0,0,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.762557077625573,"r":7.3059360730593621,"b":40.182648401826491,"l":37.260273972602747},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"Video duration vs. average percentage viewed","font":{"color":"rgba(0,0,0,1)","family":"","size":17.534246575342465},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[625,1131],"tickmode":"array","ticktext":["700","800","900","1000","1100"],"tickvals":[700,800,900,1000,1100],"categoryorder":"array","categoryarray":["700","800","900","1000","1100"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Video duration (Seconds)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[73.459000000000003,85.581000000000003],"tickmode":"array","ticktext":["74","76","78","80","82","84"],"tickvals":[74,76,78,80,82,84],"categoryorder":"array","categoryarray":["74","76","78","80","82","84"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Average percentage of video viewed","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"577857e570f1":{"x":{},"y":{},"type":"scatter"}},"cur_data":"577857e570f1","visdat":{"577857e570f1":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><div id="advanced-plotly-customisation-1" class="section level3" number="7.4.1">
<h3>
<span class="header-section-number">7.4.1</span> Advanced <code>plotly</code> customisation<a class="anchor" aria-label="anchor" href="#advanced-plotly-customisation-1"><i class="fas fa-link"></i></a>
</h3>
<p>Like we demonstrated for the bar plot, we can create a scatterplot entirely within <code class="package">plotly</code> to allow us to modify the hover template to include additional summary statistics.</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fig.duration.viewed.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plot_ly.html">plot_ly</a></span><span class="op">(</span><span class="va">video_data</span>,</span>
<span>               x <span class="op">=</span> <span class="op">~</span><span class="va">duration</span>,</span>
<span>               y <span class="op">=</span> <span class="op">~</span><span class="va">percentage_viewed</span>,</span>
<span>               type <span class="op">=</span> <span class="st">"scatter"</span>,</span>
<span>               mode <span class="op">=</span> <span class="st">"markers"</span>,</span>
<span>               hovertemplate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Video "</span>, <span class="va">video_data</span><span class="op">$</span><span class="va">video</span>,</span>
<span>                                      <span class="st">"&lt;br&gt;Average percentage viewed: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">video_data</span><span class="op">$</span><span class="va">percentage_viewed</span>,<span class="fl">1</span><span class="op">)</span>, <span class="st">"%"</span>,</span>
<span>                                      <span class="st">"&lt;br&gt; Duration: "</span>, <span class="va">video_data</span><span class="op">$</span><span class="va">duration</span>,</span>
<span>                                      <span class="st">"&lt;br&gt; Average view time: "</span>, <span class="va">video_data</span><span class="op">$</span><span class="va">average_view_time</span>,</span>
<span>                                      <span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">layout</span><span class="op">(</span>xaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Duration of video'</span><span class="op">)</span>,</span>
<span>         yaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Percentage of video viewed'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fig.duration.viewed.2</span></span></code></pre></div>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-d8cf08e77fd11be7413a" style="width:100%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-d8cf08e77fd11be7413a">{"x":{"visdat":{"57784a697452":["function () ","plotlyVisDat"]},"cur_data":"57784a697452","attrs":{"57784a697452":{"x":{},"y":{},"mode":"markers","hovertemplate":["Video 1<br>Average percentage viewed: 74.6%<br> Duration: 791<br> Average view time: 590<extra><\/extra>","Video 2<br>Average percentage viewed: 78.2%<br> Duration: 835<br> Average view time: 653<extra><\/extra>","Video 3<br>Average percentage viewed: 77.9%<br> Duration: 908<br> Average view time: 707<extra><\/extra>","Video 4<br>Average percentage viewed: 75.7%<br> Duration: 994<br> Average view time: 752<extra><\/extra>","Video 5<br>Average percentage viewed: 84.3%<br> Duration: 648<br> Average view time: 546<extra><\/extra>","Video 6<br>Average percentage viewed: 77.1%<br> Duration: 980<br> Average view time: 756<extra><\/extra>","Video 7<br>Average percentage viewed: 84.4%<br> Duration: 851<br> Average view time: 718<extra><\/extra>","Video 8<br>Average percentage viewed: 85%<br> Duration: 882<br> Average view time: 750<extra><\/extra>","Video 9<br>Average percentage viewed: 74%<br> Duration: 1108<br> Average view time: 820<extra><\/extra>"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"Duration of video"},"yaxis":{"domain":[0,1],"automargin":true,"title":"Percentage of video viewed"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[791,835,908,994,648,980,851,882,1108],"y":[74.590000000000003,78.200000000000003,77.859999999999999,75.650000000000006,84.260000000000005,77.140000000000001,84.370000000000005,85.030000000000001,74.010000000000005],"mode":"markers","hovertemplate":["Video 1<br>Average percentage viewed: 74.6%<br> Duration: 791<br> Average view time: 590<extra><\/extra>","Video 2<br>Average percentage viewed: 78.2%<br> Duration: 835<br> Average view time: 653<extra><\/extra>","Video 3<br>Average percentage viewed: 77.9%<br> Duration: 908<br> Average view time: 707<extra><\/extra>","Video 4<br>Average percentage viewed: 75.7%<br> Duration: 994<br> Average view time: 752<extra><\/extra>","Video 5<br>Average percentage viewed: 84.3%<br> Duration: 648<br> Average view time: 546<extra><\/extra>","Video 6<br>Average percentage viewed: 77.1%<br> Duration: 980<br> Average view time: 756<extra><\/extra>","Video 7<br>Average percentage viewed: 84.4%<br> Duration: 851<br> Average view time: 718<extra><\/extra>","Video 8<br>Average percentage viewed: 85%<br> Duration: 882<br> Average view time: 750<extra><\/extra>","Video 9<br>Average percentage viewed: 74%<br> Duration: 1108<br> Average view time: 820<extra><\/extra>"],"type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;

    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    $(solveme[i]).after(" <span class='webex-icon'></span>");
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    $(selects[i]).after(" <span class='webex-icon'></span>");
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var psyteachr = ' <a href="https://psyteachr.github.io/"><img src="images/logos/psyteachr_logo.png" style="height: 31px; color: white;" alt="psyTeachR: Reproducible Research" /></a>';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    psyteachr + license + cite
  );

  // open rdrr links externally
  $("a[href^='https://rdrr.io']").click(function(){
    window.open(this.href);
    return false;
  });

  // visible second sidebar in mobile
  function move_sidebar() {
    var w = window.innerWidth;
    if (w < 992) {
      $("#toc").appendTo($("#main-nav"));
    } else {
      $("#toc").appendTo($("div.sidebar-chapter"));
    }
  }
  move_sidebar();
  window.onresize = move_sidebar;
});
</script><div class="chapter-nav">
<div class="prev"><a href="Echo_tidy.html"><span class="header-section-number">6</span> Getting started with Echo360 data in R with tidyverse</a></div>
<div class="next"><a href="Echo_combine.html"><span class="header-section-number">8</span> Combining Echo360 data with other sources of data in R with tidyverse</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#Echo_course"><span class="header-section-number">7</span> Exploring Echo360 video/course level data in R with tidyverse</a></li>
<li><a class="nav-link" href="#introduction-1"><span class="header-section-number">7.1</span> Introduction</a></li>
<li>
<a class="nav-link" href="#handling-datetime-data-with-lubridate"><span class="header-section-number">7.2</span> Handling date/time data with lubridate</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#converting-variables-to-datetime-format"><span class="header-section-number">7.2.1</span> Converting variables to date/time format</a></li>
<li><a class="nav-link" href="#extracting-elements-from-datetime-data"><span class="header-section-number">7.2.2</span> Extracting elements from date/time data</a></li>
<li><a class="nav-link" href="#maths-with-date-times"><span class="header-section-number">7.2.3</span> Maths with date-times</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#total-views-for-each-video"><span class="header-section-number">7.3</span> Total views for each video</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#advanced-plotly-customisation"><span class="header-section-number">7.3.1</span> Advanced plotly customisation</a></li></ul>
</li>
<li>
<a class="nav-link" href="#video-duration-vs.-average-percentage-viewed"><span class="header-section-number">7.4</span> Video duration vs. average percentage viewed</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#advanced-plotly-customisation-1"><span class="header-section-number">7.4.1</span> Advanced plotly customisation</a></li></ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/psyteachr/scholaRship/blob/master/book/07-Echo_course.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/psyteachr/scholaRship/edit/master/book/07-Echo_course.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>scholaRship</strong>" was written by Emily Nordmann, Craig Alexander, James Bartlett, Eilidh Jack, Gaby Mahrholz, Jill MacKay, Mitchum Bock. It was last built on 2023-09-05.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
